<!-- Floating Chat Button -->
<div id="chatButton" style="
    width: 60px; height: 60px; border-radius: 50%;
    background:#0078ff; color:white; 
    display:flex; justify-content:center; align-items:center;
    position:fixed; bottom:25px; right:25px;
    font-size:28px; cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
    z-index: 9999;
">ğŸ’¬</div>

<!-- Chat Window -->
<div id="chatContainer" style="
    width: 380px; height: 550px; background:white;
    position:fixed; bottom:95px; right:25px;
    border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.3);
    display:none; flex-direction:column; overflow:hidden;
    z-index: 9999;
">

    <div style="background:#0078ff; padding:15px;
         color:white; text-align:center; font-size:18px; font-weight:600;">
        ğŸ¤– NG ChatBot
    </div>

    <div id="chatBody" style="
        flex:1; overflow-y:auto; padding:15px; background:#f0f2f5;">
        <div style="
            padding:10px 14px; background:#e4e6eb;
            border-radius:10px; width:max-content;">
            Hello! ğŸ‘‹ How can I help you today?
        </div>
    </div>

    <div style="display:flex; border-top:1px solid #ccc; background:white;">
        <input id="chatInput" type="text"
               placeholder="Type your message..."
               style="flex:1; padding:12px; border:none; outline:none;">
        <button id="sendBtn"
                style="background:#0078ff; color:white; padding:12px 18px;
                border:none; cursor:pointer;">
            â¤
        </button>
    </div>
</div>

<script>
    // Elements
    const chatButton = document.getElementById("chatButton");
    const chatContainer = document.getElementById("chatContainer");
    const chatBody = document.getElementById("chatBody");
    const chatInput = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");

    // Toggle Chat Window
    chatButton.onclick = () => {
        chatContainer.style.display =
            chatContainer.style.display === "none" ? "flex" : "none";
    };

    // Append message to chat body
    function appendMessage(text, sender) {
        const msgDiv = document.createElement("div");
        msgDiv.style.maxWidth = "75%";
        msgDiv.style.padding = "10px 14px";
        msgDiv.style.margin = "10px 0";
        msgDiv.style.borderRadius = "12px";
        msgDiv.style.fontSize = "14px";

        if (sender === "user") {
            msgDiv.style.background = "#daf8cb";
            msgDiv.style.marginLeft = "auto";
        } else {
            msgDiv.style.background = "#e4e6eb";
            msgDiv.style.marginRight = "auto";
        }

        msgDiv.innerText = text;
        chatBody.appendChild(msgDiv);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Send Message
    function sendMessage() {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        appendMessage(userMessage, "user");
        chatInput.value = "";

        fetch("/rasa-webhook/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userMessage })
        })
        .then(res => res.json())
        .then(data => {
            appendMessage(data.reply || "Sorry, I didn't understand.", "bot");
        })
        .catch(() => {
            appendMessage("âš ï¸ Unable to connect to chatbot server.", "bot");
        });
    }

    sendBtn.onclick = sendMessage;

    chatInput.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
            event.preventDefault();
            sendMessage();
        }
    });
</script>
